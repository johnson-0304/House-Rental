<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <Title>House Details</Title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.6/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
              integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn"
              crossorigin="anonymous">
        <script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
        <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css"/>

    </head>
    <style>
        pre {
            font-family: 'Avenir', Verdana, sans-serif;
            font-size: 24px
        }

        @media (min-width: 576px) {
            .icon {
                height: 50px;
            }
        }

        @media (min-width: 768px) {
        }

        @media (min-width: 992px) {
            .icon {
                height: 60px;
            }
        }

        @media (min-width: 1200px) {
            .icon {
                height: 60px;
            }
        }

        .btn:focus, .btn:active, button:focus, button:active {
            outline: none !important;
            box-shadow: none !important;
        }

        #image-gallery .modal-footer {
            display: block;
        }

        .thumb {
            margin-top: 15px;
            margin-bottom: 15px;
        }

        .box-border {
            background-color: white;
            border-radius: 10px;
            box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
        }
    </style>
    <body>
        <!--header-->
        <div class="headerpage"></div>
        <!--header over-->

        <!--body-->
        <div class="container px-5">


            <!--/*@thymesVar id="houseId" type="templates"*/-->
            <span id="houseId" style="display: none" th:text="${houseId}"></span>
            <!--image + info-->
            <div class="row box-border p-3">
                <div class="col-md-6 col-12 rounded p-1 order-2 order-md-1">
                    <div class="col-12"><h2 id="buildingName">1</h2></div>
                    <div class="col-12 mt-2"><h4>Address:</h4>
                        <text id="address"> class="font-weight-normal">Lot 1513 Taman xxxxx</text>
                    </div>
                    <div class="col-12 mt-2"><h4>Rental:</h4>
                        <text class="font-weight-normal" id="rental">RM4500</text>
                    </div>
                    <div class="col-12 mt-2"><h4>State:</h4>
                        <text class="font-weight-normal" id="state">Selangor</text>
                    </div>
                    <div class="col-12 mt-2"><h4>House Owner Phone:</h4>
                        <text class="font-weight-normal" id="phone">Selangor</text>
                    </div>
                    <div class="col-12 mt-2">
                        <a th:href="@{'/rentHousePage?id=' + ${houseId}}" class="btn btn-primary mt-1"
                           style="color: white;">Rent
                            this House</a>
                        <!--                        <a th:href="@{'/bookAppointment?id=' + ${houseId}}" class="btn btn-success"-->
                        <!--                           style="color: white;">Book Appointment</a>-->
                        <!--Modal-->
                        <button type="button" class="btn btn-success mt-1" data-toggle="modal" data-target="#myModal">
                            Book Appointment
                        </button>

                        <!-- The Modal -->
                        <div class="modal" id="myModal">
                            <div class="modal-dialog">
                                <div class="modal-content">

                                    <!-- Modal Header -->
                                    <div class="modal-header">
                                        <h4 class="modal-title">Book Appointment</h4>
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    </div>

                                    <!-- Modal body -->
                                    <div class="modal-body">
                                        <form id="appointmentForm">
                                            <input type="hidden" name="id" th:value="${houseId}">

                                            <label>Select Date</label>
                                            <input id="datepicker" class="mt-3" name="date" width="276" required/>
                                            <label>Select Time</label>
                                            <input id="timepicker" name="time" class="mt-3" width="276" required/>
                                            <button type="submit" class="btn btn-primary mt-3">Book Appointment</button>


                                            <!--                                            <a th:href="@{'/bookAppointment?id=' + ${houseId}}" class="btn btn-success"-->
                                            <!--                                               style="color: white;">Book Appointment</a>-->
                                        </form>

                                    </div>

                                    <!-- Modal footer -->
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <!--Modal end-->
                    </div>


                </div>
                <div class="col-md-6 col-12 my-1 order-1 order-md-2">
                    <div><img id="mainImage" class="" style="min-width: 100%!important;max-width: 100%;"
                              src="https://images.pexels.com/photos/186077/pexels-photo-186077.jpeg?cs=srgb&dl=pexels-binyamin-mellish-186077.jpg&fm=jpg">
                    </div>
                </div>

            </div>
            <!--image + info end-->
            <!--facility-->

            <div class="row">
                <div class="col-12 mt-3 box-border">
                    <div class="row p-3">
                        <div class="col-6 col-sm-6 col-md-4 mt-5">
                            <img class="icon mx-auto d-block"
                                 src="https://img.icons8.com/ios/50/000000/skyscrapers.png"/>
                            <h6 class="mt-3 d-flex justify-content-center" style="text-align: center;" id="type">High
                                Rise</h6>
                        </div>
                        <div class="col-6 col-sm-6 col-md-4 mt-5">
                            <img class="icon mx-auto d-block" src="https://img.icons8.com/ios/48/000000/bed.png"/>
                            <h6 class="mt-3 d-flex justify-content-center" style="text-align: center;" id="bedroom">1
                                Bed</h6>

                        </div>
                        <div class="col-6 col-sm-6 col-md-4 mt-5">
                            <img class="icon mx-auto d-block"
                                 src="https://img.icons8.com/ios/50/000000/prefab-house.png"/>
                            <h6 class="mt-3 d-flex justify-content-center" style="text-align: center;" id="sqft">270
                                sqft</h6>

                        </div>
                        <div class="col-6 col-sm-6 col-md-4 mt-5">
                            <img class="icon mx-auto d-block"
                                 src="https://img.icons8.com/ios/50/000000/toilet-room.png"/>
                            <h6 class="mt-3 d-flex justify-content-center" style="text-align: center;" id="bathroom">3
                                Bathroom</h6>
                        </div>

                        <div class="col-6 col-sm-6 col-md-4 mt-5">
                            <img class="icon mx-auto d-block" src="https://img.icons8.com/ios/50/000000/furniture.png"/>
                            <h6 class="mt-3 d-flex justify-content-center" style="text-align: center;" id="furnish">
                                Fully
                                Furnished</h6>
                        </div>

                        <div class="col-6 col-sm-6 col-md-4 mt-5">
                            <img class="icon mx-auto d-block" src="https://img.icons8.com/ios/50/000000/car--v1.png"/>
                            <h6 class="mt-3 d-flex justify-content-center" style="text-align: center;" id="carpark">1
                                Carpark</h6>
                        </div>
                    </div>
                </div>
            </div>
            <!--facility end-->
            <!--description-->
            <div class="row mt-3">
                <div class="col-12 p-4 box-border" style="">
                    <h4>Description</h4>
                    <pre id="description" class="mt-3" style="font-family: 'Avenir', Verdana, sans-serif;font-size: 16px">Description
DUA SENTRAL RESIDENCE (Also Formerly Known As Ramada Dua Sentral Residence)
New 5 Year Old Highrise Building
Very Convenient Location, 10 Minutes Walking Distance To KL Sentral National Transit Station  Also To NU Sentral Shopping Mall.
Built Up 710sq.Ft
Fully Furnished 1 Bedroom 1 Bathroom Apartment.
Modern Concept Apartment With Open Kitchen Fitted With Electric Induction Cooker.
Fitted With 3 Air-Condition Unit With Individual Temperature Controls.
Other Amenities In The Bu</pre>
                </div>
            </div>
            <!--description end-->
            <!--image-->
            <div class="row mt-3 box-border p-3">
                <h4 class="">Image</h4>
                <div class="row col-12">
                    <div class="row" id="images-container">
                        <div class="col-lg-3 col-md-4 col-xs-6 thumb">
                            <a class="thumbnail" href="#" data-image-id="" data-toggle="modal" data-title=""
                               data-image="https://images.pexels.com/photos/853168/pexels-photo-853168.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260"
                               data-target="#image-gallery">
                                <img class="img-thumbnail"
                                     src="https://images.pexels.com/photos/853168/pexels-photo-853168.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260"
                                     alt="Another alt text">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6 thumb">
                            <a class="thumbnail" href="#" data-image-id="" data-toggle="modal" data-title=""
                               data-image="https://images.pexels.com/photos/158971/pexels-photo-158971.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260"
                               data-target="#image-gallery">
                                <img class="img-thumbnail"
                                     src="https://images.pexels.com/photos/158971/pexels-photo-158971.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260"
                                     alt="Another alt text">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6 thumb">
                            <a class="thumbnail" href="#" data-image-id="" data-toggle="modal" data-title="Im so nice"
                               data-image="https://images.pexels.com/photos/158971/pexels-photo-158971.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260"
                               data-target="#image-gallery">
                                <img class="img-thumbnail"
                                     src="https://images.pexels.com/photos/158971/pexels-photo-158971.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260"
                                     alt="Another alt text">
                            </a>
                        </div>
                    </div>


                    <div class="modal fade" id="image-gallery" tabindex="-1" role="dialog"
                         aria-labelledby="myModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title" id="image-gallery-title"></h4>
                                    <button type="button" class="close" data-dismiss="modal"><span
                                            aria-hidden="true">×</span><span class="sr-only">Close</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <img id="image-gallery-image" class="img-responsive col-md-12" src="">
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary float-left" id="show-previous-image">
                                        <i
                                                class="fa fa-arrow-left"></i>
                                    </button>

                                    <button type="button" id="show-next-image" class="btn btn-secondary float-right"><i
                                            class="fa fa-arrow-right"></i>
                                    </button>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <!--image end-->


        </div>
        <!--body end-->
        <!--footer-->
        <div class="footerpage"></div>
        <!--footer over-->

        <!--script-->
        <script>
            $(function () {
                $("#appointmentForm").submit(function (e) {
                    e.preventDefault();
                    // var date = $("#date").val();
                    // console.log(date);
                    $.post("bookAppointment", $(this).serialize(), function (data) {
                        //data=response flag:true:register success, false: register fail
                        if (data.flag) {
                            alert("Appointment Request Sent, please wait for the confirmation from house owner.");
                            location.href = "myAppointment.html";

                        } else {
                            // info false, return 0 = not login, return 1 = too many request, return 2 = self-book, return 3 = date problem
                            // alert(data.errorMsg);
                            if (data.errorMsg === "0") {
                                alert("Please Login First");
                                location.href = "login.html";
                            } else if (data.errorMsg === "1") {
                                alert("Only max to 3 appointment request3 at the same time only!")
                                location.href = "myAppointment.html";
                            } else if (data.errorMsg === "2") {
                                alert("You cannot book appointment for your house!");
                                location.href = "index.html"
                            } else if (data.errorMsg === "3") {
                                alert("You can only select the date after today!");
                            } else if (data.errorMsg === "4") {
                                alert("Admin cannot book appointment!");
                            } else if (data.errorMsg === "5") {
                                alert("House is not available!");
                            }

                        }
                    })
                })
            });
        </script>
        <script>
            $(function () {
                $(".headerpage").load("header.html");
                $(".footerpage").load("footer.html");
            });
            $('#datepicker').datepicker({
                uiLibrary: 'bootstrap4'
            });
            $('#timepicker').timepicker();

        </script>
        <script>
            let modalId = $('#image-gallery');

            $(document)
                .ready(function () {

                    loadGallery(true, 'a.thumbnail');

                    //This function disables buttons when needed
                    function disableButtons(counter_max, counter_current) {
                        $('#show-previous-image, #show-next-image')
                            .show();
                        if (counter_max === counter_current) {
                            $('#show-next-image')
                                .hide();
                        } else if (counter_current === 1) {
                            $('#show-previous-image')
                                .hide();
                        }
                    }

                    /**
                     *
                     * @param setIDs        Sets IDs when DOM is loaded. If using a PHP counter, set to false.
                     * @param setClickAttr  Sets the attribute for the click handler.
                     */

                    function loadGallery(setIDs, setClickAttr) {
                        let current_image,
                            selector,
                            counter = 0;

                        $('#show-next-image, #show-previous-image')
                            .click(function () {
                                if ($(this)
                                    .attr('id') === 'show-previous-image') {
                                    current_image--;
                                } else {
                                    current_image++;
                                }

                                selector = $('[data-image-id="' + current_image + '"]');
                                updateGallery(selector);
                            });

                        function updateGallery(selector) {
                            let $sel = selector;
                            current_image = $sel.data('image-id');
                            $('#image-gallery-title')
                                .text($sel.data('title'));
                            $('#image-gallery-image')
                                .attr('src', $sel.data('image'));
                            disableButtons(counter, $sel.data('image-id'));
                        }

                        if (setIDs == true) {
                            $('[data-image-id]')
                                .each(function () {
                                    counter++;
                                    $(this)
                                        .attr('data-image-id', counter);
                                });
                        }
                        $(setClickAttr)
                            .on('click', function () {
                                updateGallery($(this));
                            });
                    }
                });

            // build key actions
            $(document)
                .keydown(function (e) {
                    switch (e.which) {
                        case 37: // left
                            if ((modalId.data('bs.modal') || {})._isShown && $('#show-previous-image').is(":visible")) {
                                $('#show-previous-image')
                                    .click();
                            }
                            break;

                        case 39: // right
                            if ((modalId.data('bs.modal') || {})._isShown && $('#show-next-image').is(":visible")) {
                                $('#show-next-image')
                                    .click();
                            }
                            break;

                        default:
                            return; // exit this handler for other keys
                    }
                    e.preventDefault(); // prevent the default action (scroll / move caret)
                });

        </script>
        <script>
            var houseId = document.getElementById('houseId').innerHTML;
            console.log(houseId);
            $.get("getHouseInfoById?id=" + houseId, {}, function (data) {

                if (data==null){
                    alert("House Not Exists!");
                    location.href='index.html'
                }

                console.log(data);
                $("#buildingName").html(data.buildingName);
                $("#address").html(data.address);
                $("#rental").html("RM " + data.rental);
                $("#state").html(data.state);
                console.log(data.mainImageUrl);
                $("#mainImage").attr("src", data.mainImageUrl);


                $("#type").html(data.type);
                $("#bedroom").html(data.bedroom + " Bedroom");
                $("#sqft").html(data.squareFt + " Sqft");
                $("#bathroom").html(data.bathroom + " Bathroom");
                $("#furnish").html(data.furnish);
                $("#carpark").html(data.carPark + " Carpark");
                $("#description").html(data.description);
                $("#phone").html(data.phone);

                var imgUrl = data.imageUrl;
                var imgUrlList = new Array();

                if (imgUrl === "no" || imgUrl === null) {
                    imgUrlList[0] = "image/no.jpg";
                } else if (imgUrl.includes(',')) {
                    imgUrlList = imgUrl.split(',');
                } else if (!imgUrl.includes(',')) {
                    imgUrlList[0] = imgUrl;
                } else {
                    imgUrlList[0] = "image/no.jpg";
                }
                console.log(imgUrlList);

                var imageHtml = "";
                for (var i = 0; i < imgUrlList.length; i++) {

                    var imageDiv = "                        <div class=\"col-lg-3 col-md-4 col-xs-6 thumb\">\n" +
                        "                            <a class=\"thumbnail\" href=\"#\" data-image-id=\"\" data-toggle=\"modal\" data-title=\"\"\n" +
                        "                               data-image=\"" + imgUrlList[i] + "\"\n" +
                        "                               data-target=\"#image-gallery\">\n" +
                        "                                <img class=\"img-thumbnail\"\n" +
                        "                                     src=\"" + imgUrlList[i] + "\"\n" +
                        "                                     alt=\"Another alt text\">\n" +
                        "                            </a>\n" +
                        "                        </div>"

                    imageHtml += imageDiv
                }
                $("#images-container").html(imageHtml);

                // bind the js again
                let modalId = $('#image-gallery');

                $(document)
                    .ready(function () {

                        loadGallery(true, 'a.thumbnail');

                        //This function disables buttons when needed
                        function disableButtons(counter_max, counter_current) {
                            $('#show-previous-image, #show-next-image')
                                .show();
                            if (counter_max === counter_current) {
                                $('#show-next-image')
                                    .hide();
                            } else if (counter_current === 1) {
                                $('#show-previous-image')
                                    .hide();
                            }
                        }

                        /**
                         *
                         * @param setIDs        Sets IDs when DOM is loaded. If using a PHP counter, set to false.
                         * @param setClickAttr  Sets the attribute for the click handler.
                         */

                        function loadGallery(setIDs, setClickAttr) {
                            let current_image,
                                selector,
                                counter = 0;

                            $('#show-next-image, #show-previous-image')
                                .click(function () {
                                    if ($(this)
                                        .attr('id') === 'show-previous-image') {
                                        current_image--;
                                    } else {
                                        current_image++;
                                    }

                                    selector = $('[data-image-id="' + current_image + '"]');
                                    updateGallery(selector);
                                });

                            function updateGallery(selector) {
                                let $sel = selector;
                                current_image = $sel.data('image-id');
                                $('#image-gallery-title')
                                    .text($sel.data('title'));
                                $('#image-gallery-image')
                                    .attr('src', $sel.data('image'));
                                disableButtons(counter, $sel.data('image-id'));
                            }

                            if (setIDs == true) {
                                $('[data-image-id]')
                                    .each(function () {
                                        counter++;
                                        $(this)
                                            .attr('data-image-id', counter);
                                    });
                            }
                            $(setClickAttr)
                                .on('click', function () {
                                    updateGallery($(this));
                                });
                        }
                    });

                // build key actions
                $(document)
                    .keydown(function (e) {
                        switch (e.which) {
                            case 37: // left
                                if ((modalId.data('bs.modal') || {})._isShown && $('#show-previous-image').is(":visible")) {
                                    $('#show-previous-image')
                                        .click();
                                }
                                break;

                            case 39: // right
                                if ((modalId.data('bs.modal') || {})._isShown && $('#show-next-image').is(":visible")) {
                                    $('#show-next-image')
                                        .click();
                                }
                                break;

                            default:
                                return; // exit this handler for other keys
                        }
                        e.preventDefault(); // prevent the default action (scroll / move caret)
                    });


            })
        </script>
    </body>
</html>